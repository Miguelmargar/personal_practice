<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="../static/style.css" rel="stylesheet" type="text/css"/>
    <title>Google Maps practice</title>
</head>

<body>
	<h1>HELLO</h1>

	<div id="map"></div>

	<script>

		var latLonStations = {{ latLonStations | safe }};	
		
		// Initialize and add the map
		function initMap() {

		// The location of Ireland
  		var ireland = {lat: 53.2734, lng: -7.77832031};

	  	// The map, centered at Ireland
  		var map = new google.maps.Map(
	      	document.getElementById('map'), {zoom: 7, center: ireland});

		
		var infowindow = new google.maps.InfoWindow();

		// place different stations markers on the map
		for (var i = 0; i < latLonStations.length; i++) {
			var location = {lat: latLonStations[i][1], lng: latLonStations[i][2]};
			var marker = new google.maps.Marker({animation: google.maps.Animation.DROP, position: location, map: map});
			
			google.maps.event.addListener(marker, 'click', (function(marker, i) {
				return function() {
					infowindow.setContent('<div class="infoWin">' +
					'<p class="detail">' + latLonStations[i][0] + '</p>' +
					'</div>');
					infowindow.open(map, marker);
				}
			})(marker, i));


		} // initMap()


		// start the user's geolocations---------------------------------------
		infoWindow = new google.maps.InfoWindow;

		// Try HTML5 geolocation.
        	if (navigator.geolocation) {
          	navigator.geolocation.getCurrentPosition(function(position) {
            	var pos = {
              	lat: position.coords.latitude,
              	lng: position.coords.longitude
            	};

            	infoWindow.setPosition(pos);
            	infoWindow.setContent('Location found.');
            	infoWindow.open(map);
            	map.setCenter(pos);
          	}, function() {
	        handleLocationError(true, infoWindow, map.getCenter());
          	});
        	} else {
          	// Browser doesn't support Geolocation
          	handleLocationError(false, infoWindow, map.getCenter());
        		}
		}

		function handleLocationError(browserHasGeolocation, infoWindow, pos) {
        	infoWindow.setPosition(pos);
	        infoWindow.setContent(browserHasGeolocation ?
                              'Error: The Geolocation service failed.' :
                              'Error: Your browser doesn\'t support geolocation.');
        	infoWindow.open(map);
      		}

	 </script>

	 </script>
	 <script async defer
    		src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAXUnw_66vWdVYo2Cj73v6ZwiIpyjZbdhM&callback=initMap">
	 </script>

</body>

</html>